!function(n){n(function(){var t=wpps_results_vars.legacy_api_url,e=wpps_results_vars.permalink_structure,s={apps:{},models:{},collections:{},views:{}};_.templateSettings={evaluate:/[<{][%{](.+?)[%}][}>]/g,interpolate:/[<{][%{]=(.+?)[%}][}>]/g,escape:/[<{][%{]-(.+?)[%}][}>]/g},s.models.Item=Backbone.Model.extend({defaults:{title:"Empty Post",url:null,image_url:null,description:null,categories:[],tags:[],type:"post",status:!0,card:"",...wpps_results_vars.item_extra_data}}),s.collections.Items=Backbone.Collection.extend({model:s.models.Item}),s.views.Item=Backbone.View.extend({tagName:"div",className:"rs_result_row",template:_.template(n("#wp_psearch_result_itemTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){return""!==this.model.get("card")?this.setElement(this.model.get("card")):this.$el.html(this.template(this.model.toJSON())),this}}),s.views.ResultContainer=Backbone.View.extend({cached:{},addCache:function(t,e,s,i){this.cached[t+"-"+e+"-"+s]=i},flushCached:function(){this.cached={}},events:{"click .ps_navigation":"initRouter"},initRouter:function(t){t.preventDefault();t=n(t.target).data("href");Backbone.history.navigate(t,{trigger:!0})},footerTpl:_.template(n("#wp_psearch_result_footerTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),initialize:function(){this.total_items=0,this.search_in=wpps_results_vars.search_in,this.ps_lang=wpps_results_vars.ps_lang,this.next_page_number=1,this.is_first_load=!0,this.listenTo(this.collection,"add",this.addItem),this.items_container=this.$("#ps_items_container"),this.footer=this.$("#ps_footer_container"),this.ps_more_check=this.$("#ps_more_check"),this.ps_more_result_popup=this.$("#ps_more_result_popup"),this.ps_no_more_result_popup=this.$("#ps_no_more_result_popup"),this.ps_fetching_result_popup=this.$("#ps_fetching_result_popup"),this.ps_no_result_popup=this.$("#ps_no_result_popup"),this.perPage=this.$("#ps_items_container").data("perpage"),this.endless_loading=!1,n(window).on("scroll",function(){1<this.next_page_number&&this.endlessScrollLoad()}.bind(this))},render:function(){return this.footer.html(this.footerTpl({next_page_number:this.next_page_number,first_load:this.is_first_load,total_items:this.total_items})),this},addItem:function(t){var e=new s.views.Item({model:t});this.items_container.append(e.render().el),""==t.get("card")&&"plugin"==wpps_results_vars.template_type&&"list"==wpps_results_vars.display_type&&this.items_container.append('<div style="clear:both"></div>')},clearAll:function(){return _.invoke(this.collection.where({status:!0}),"destroy"),this.items_container=this.$("#ps_items_container"),this.items_container.html(""),!1},prepareContainer:function(){var t;"block"!=wpps_results_vars.content_type&&("theme"==wpps_results_vars.template_type&&(-1!==n.inArray(this.search_in,wpps_results_vars.taxonomies_support)?this.items_container.addClass("ps_grid_container"):this.items_container.removeClass("ps_grid_container")),"theme"!=wpps_results_vars.template_type||n.isEmptyObject(wpps_results_vars.child_container)||this.search_in in wpps_results_vars.child_container&&(function t(e,s){var i=!1;return 0===e.children().length?e.hasClass(s)&&(i=!0):e.children().each(function(){if(i=t(n(this),s))return!1}),i}(t=n(wpps_results_vars.child_container[this.search_in]),"ps_theme_items_container")||function t(e,s){0===e.children().length?e.hasClass("no-add")||e.addClass(s):e.children().each(function(){t(n(this),s)})}(t,"ps_theme_items_container"),this.items_container.html("").append(t),this.items_container=this.$(".ps_theme_items_container")))},routeSearchIn:function(){this.total_items=0,this.next_page_number=1,this.is_first_load=!0,this.endless_loading=!1,this.clearAll(),this.prepareContainer(),this.getItems()},getItems:function(){this.cached[this.search_in+"-"+this.ps_lang+"-"+this.next_page_number]?(item_list=this.cached[this.search_in+"-"+this.ps_lang+"-"+this.next_page_number],this.addItems(item_list)):((this.is_first_load?this.ps_fetching_result_popup:this.ps_more_result_popup).fadeIn("fast"),n.get(t,{search_in:this.search_in,ps_lang:this.ps_lang,psp:this.next_page_number,perpage:this.perPage},function(t){this.addCache(this.search_in,this.ps_lang,this.next_page_number,t),this.addItems(t),(this.is_first_load?this.ps_fetching_result_popup:this.ps_more_result_popup).fadeOut("normal"),0==t.total&&(this.is_first_load?this.ps_no_result_popup:this.ps_no_more_result_popup).fadeIn("normal").fadeOut(1e3)}.bind(this)))},addItems:function(t){this.$(".ps_heading_search_in_name").html(t.search_in_name),0<t.total?(this.total_items+=t.items.length,n.each(t.items,function(t,e){void 0!==e.card&&(e.card=e.card.replace(/<\!--.*?-->/g,"")),this.collection.add(e)}.bind(this)),t.total>t.items.length?(this.next_page_number++,this.render(),this.endless_loading=!1):(this.next_page_number=0,this.render()),this.compatibilityScript()):(this.next_page_number=0,this.render())},endlessScrollLoad:function(){var t,e;0==this.endless_loading&&(t=n("#ps_more_check").offset().top+n("#ps_more_check").height()>=n(window).scrollTop(),e=n("#ps_more_check").offset().top<=n(window).scrollTop()+n(window).height(),t&&e&&(this.endless_loading=!0,this.is_first_load=!1,this.getItems()))},compatibilityScript:function(){this.items_container.find(".animateMe").each(function(){var t=n(this),e=t.data("animation");t.addClass("animated").addClass(e)}),("function"==typeof this.items_container.masonry||0<this.items_container.find(".masonry").length)&&(this.items_container.find(".masonry").length<1?setTimeout(function(){this.items_container.masonry(),this.items_container.masonry("reload")},500):setTimeout(function(){this.items_container.find(".masonry").masonry(),this.items_container.find(".masonry").masonry("reload")},500)),n(document).trigger("ps-result-items-added")}}),s.apps.App=Backbone.Router.extend({routes:{"?:query_parameters":"getResults_QueryString","keyword/:s_k/search-in/:s_in":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/in-taxonomy/:in_t":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in/in-taxonomy/:int_t":"getResults","keyword/:s_k/search-in/:s_in/in-taxonomy/:int_t/cat-in/:c_in":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other/cat-in/:c_in":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other/in-taxonomy/:int_t":"getResults","keyword/:s_k/search-in/:s_in/in-taxonomy/:int_t/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in/in-taxonomy/:int_t/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in/search-other/:s_other/in-taxonomy/:int_t":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other/cat-in/:c_in/in-taxonomy/:int_t":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other/in-taxonomy/:int_t/cat-in/:c_in":"getResults","keyword/:s_k/search-in/:s_in/in-taxonomy/:int_t/cat-in/:c_in/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/in-taxonomy/:int_t/search-other/:s_other/cat-in/:c_in":"getResults"},initialize:function(){this.collection=new s.collections.Items,this.resultCointainerView=new s.views.ResultContainer({collection:this.collection,el:n("#ps_results_container")}),Backbone.history&&Backbone.history.start({pushState:!0,root:wpps_results_vars.search_page_path}),Backbone.history.navigate(wpps_results_vars.default_navigate,{trigger:!0})},getResults:function(t,e){this.resultCointainerView.search_in=e,this.resultCointainerView.$(".ps_navigation").parent(".rs_result_other_item").removeClass("rs_result_other_item_activated"),this.resultCointainerView.$(".ps_navigation"+e).parent(".rs_result_other_item").addClass("rs_result_other_item_activated"),this.resultCointainerView.routeSearchIn()},getResults_QueryString:function(t){""==e&&(t=this.parseQueryString(t),this.resultCointainerView.search_in=t.search_in,this.resultCointainerView.$(".ps_navigation").parent(".rs_result_other_item").removeClass("rs_result_other_item_activated"),this.resultCointainerView.$(".ps_navigation"+t.search_in).parent(".rs_result_other_item").addClass("rs_result_other_item_activated"),this.resultCointainerView.routeSearchIn())},parseQueryString:function(t){var e={};return t&&_.each(_.map(decodeURI(t).split(/&/g),function(t,e){var s=t.split("="),i={};return 1<=s.length&&(t=void 0,2==s.length&&(t=s[1]),i[s[0]]=t),i}),function(t){_.extend(e,t)}),e}}),wpps_app.addInitializer(function(){new s.apps.App})})}(jQuery);