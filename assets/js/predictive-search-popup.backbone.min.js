jQuery(document).ready(function(a){var b=wpps_vars.legacy_api_url,c=wpps_vars.permalink_structure,d=wpps_vars.search_page_url,e=wpps_vars.minChars,f=wpps_vars.delay,g=24,h=!0,i=!0,j="fadeInUpBig";"undefined"!=typeof wpps_vars.cache_timeout&&(g=wpps_vars.cache_timeout),"undefined"!=typeof wpps_vars.is_debug&&"yes"!=wpps_vars.is_debug&&(h=!1),"undefined"!=typeof wpps_vars.allow_result_effect&&"yes"!=wpps_vars.allow_result_effect&&(i=!1),"undefined"!=typeof wpps_vars.show_effect&&(j=wpps_vars.show_effect),h&&console.log("Predictive Search -- DEBUG");var k={apps:{},models:{},collections:{},views:{}};_.templateSettings={evaluate:/[<{][%{](.+?)[%}][}>]/g,interpolate:/[<{][%{]=(.+?)[%}][}>]/g,escape:/[<{][%{]-(.+?)[%}][}>]/g},k.models.Item=Backbone.Model.extend({defaults:{title:"Empty Post",keyword:"",url:null,image_url:null,description:null,categories:[],type:"post",status:!0,...wpps_vars.item_extra_data}}),k.collections.Items=Backbone.Collection.extend({model:k.models.Item,totalItems:function(){return this.where({status:!0}).length},haveItems:function(a){return this.where({type:a}).length}}),k.views.Item=Backbone.View.extend({tagName:"li",className:function(){switch(this.model.get("type")){case"nothing":return"ac_odd nothing";default:return"ac_odd";}},itemTpl:_.template(a("#wp_psearch_itemTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),footerSidebarTpl:_.template(a("#wp_psearch_footerSidebarTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),footerHeaderTpl:_.template(a("#wp_psearch_footerHeaderTpl").html().replace("/*<![CDATA[*/","").replace("/*]]>*/","")),initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){switch(this.model.get("type")){case"header":this.$el.html("<div class=\"ajax_search_content_title\">"+this.model.get("title")+"</div>");break;case"footerSidebar":this.$el.html(this.footerSidebarTpl(this.model.toJSON()));break;case"footerHeader":this.$el.html(this.footerHeaderTpl(this.model.toJSON()));break;case"footerCustom":this.$el.html(_.template(a("#wp_psearch_footerCustomTpl_"+this.model.get("templateID")).html().replace("/*<![CDATA[*/","").replace("/*]]>*/",""))(this.model.toJSON()));break;case"nothing":this.$el.html("<div class=\"ajax_no_result\">"+this.model.get("title")+"</div>");break;default:i?this.$el.html(this.itemTpl(this.model.toJSON())).addClass("animated "+j).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){a(this).removeClass("animated "+j)}):this.$el.html(this.itemTpl(this.model.toJSON()));}return this}}),k.views.PopupResult=Backbone.View.extend({initialize:function(){this.predictive_search_input=null,this.original_ps_search_other="",this.delaytime=0,this.prepend=!1,this.listenTo(this.collection,"add",this.addItem),this.list_items_container=this.$(".predictive_search_results")},createItems:function(b,c){this.prepend=c,a.each(b,function(a,b){this.collection.add(b)}.bind(this));var d=a(this.predictive_search_input).data("ps-id"),e=a(".wpps_bar-"+d);""==this.original_ps_search_other&&(this.original_ps_search_other=e.data("ps-search_other")),""==this.original_ps_search_in&&(this.original_ps_search_in=e.data("ps-search_in")),ps_search_other=this.original_ps_search_other.split(","),new_ps_search_other=[],new_ps_search_in="",a.each(ps_search_other,function(a,b){0<this.collection.haveItems(b)&&(new_ps_search_other.push(b),""==new_ps_search_in&&(new_ps_search_in=b))}.bind(this)),""!=new_ps_search_in&&(e.data("ps-search_in",new_ps_search_in),a(this.predictive_search_input).parents(".wpps_form").find("input[name=search_in]").val(new_ps_search_in)),0==new_ps_search_other.length&&(new_ps_search_other=[e.data("ps-search_in")]),e.data("ps-search_other",new_ps_search_other.join(",")),a(this.predictive_search_input).parents(".wpps_form").find("input[name=search_other]").val(new_ps_search_other.join(","))},addItem:function(b){var c=new k.views.Item({model:b}),d=c.render().el;this.prepend?this.list_items_container.prepend(d):this.list_items_container.append(d),a.data(d,"ac_data",b.attributes)},clearAll:function(){return _.invoke(this.collection.where({status:!0}),"destroy"),!1}}),k.apps.App={initialize:function(){a(document).on("click",".wpps_nav_submit_bt",this.goToSearchResultPage),a(".wpps_form").on("keypress",function(a){if(13==a.keyCode)return this.goToSearchResultPage(a),!1}.bind(this)),a(".wpps_category_selector").on("change",function(){a(this).parents(".wpps_container").find(".wpps_nav_facade_label").html(a(this).find("option:selected").text().trim())}).on("focus",function(){a(this).parents(".wpps_container").addClass("wpps_container_active")}).on("blur",function(){a(this).parents(".wpps_container").removeClass("wpps_container_active")}),a(document).on("click",".wpps_mobile_icon",function(){var b=a(this).parents(".wpps_bar"),c=b.data("ps-id"),d=5,e=a(this).offset().top+a(this).find("svg").outerHeight(),f=!1;if(680<window.innerWidth&&(d=b.offset().left,f=b.innerWidth()),a(this).hasClass("active"))a(this).removeClass("active"),b.append(a(".wpps_container-"+c)),a("#wpps_mobile_popup-"+c).remove();else if(a(this).addClass("active"),a("<div class=\"wpps_mobile_popup\" id=\"wpps_mobile_popup-"+c+"\"></div>").appendTo(document.body),b.find(".wpps_container").appendTo(a("#wpps_mobile_popup-"+c)),a("#wpps_mobile_popup-"+c).css({transform:"translate3d("+d+"px, "+e+"px, 0)"}),f){a("#wpps_mobile_popup-"+c).css({width:f+"px"});var g=a("#wpps_mobile_popup-"+c).find(".wpps_form"),h=g.find(".wpps_category_selector").data("ps-cat_max_wide"),i=g.innerWidth()*h/100;g.find(".wpps_nav_facade_label").css("max-width",i)}a(".ac_input_"+c).trigger("ps_mobile_icon_click")}),this.initPredictSearch()},initPredictSearch:function(){a(".wpps_search_keyword").each(function(){a(this).ps_autocomplete(b,{minChars:e,delay:f,cacheTimeout:g,isDebug:h,scrollHeight:2e3,loadingClass:"predictive_loading",highlight:!1},k);var c=a(this).parents(".wpps_bar"),d=c.data("ps-search_in"),i=c.data("ps-search_other");c.find("input[name=search_in]").val(d),c.find("input[name=search_other]").val(i),a(this).result(function(b,c,d){""!=c&&a(this).val(c)})}).on("focus",function(){a(this).parents(".wpps_container").addClass("wpps_container_active")}).on("blur",function(){a(this).parents(".wpps_container").removeClass("wpps_container_active")})},goToSearchResultPage:function(b){var c=a(b.target),d=c.parents(".wpps_container");predictive_search_input=d.find(".wpps_search_keyword"),cat_selected=d.find(".wpps_category_selector option:selected"),""!=predictive_search_input.val()&&predictive_search_input.val()!=predictive_search_input.data("ps-default_text")?d.find(".wpps_form").trigger("submit"):""!==cat_selected.val()&&(cat_href=cat_selected.data("href"),window.location=cat_href)}};var l=k.apps.App;l.initialize()});